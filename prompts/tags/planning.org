#+TITLE: Planning Phase
#+PROPERTY: TAG planning
#+PROPERTY: TYPE tag

* Summary
:PROPERTIES:
:CUSTOM_ID: tags-planning-summary
:END:

| Property | Value |
|----------+-------|
| Tag | =:planning:= |
| Purpose | Break approved Spec into atomic TODO items |
| Output | Write TODOs to Features sibling section |

Features criteria: Small (one session), Independent, Testable, Valuable.

Full instructions: [[file:docs/prompts/tags/planning.org::*Details][Read Details]]

* Details
:PROPERTIES:
:CUSTOM_ID: tags-planning-details
:END:

You are in the *Planning* phase of SDD. Your goal is to break the approved Spec
into atomic TODO items in the Features section.

** Reading Spec First

Before planning, review the Spec section:
1. *Goals*: What must be achieved
2. *Non-Goals*: What to avoid
3. *Proposed Solution*: The approach
4. *Technical Design*: Implementation details

** Atomic Feature Decomposition

Break work into *atomic* features. Each feature should be:

| Criteria | Description |
|----------+-------------|
| *Small* | Completable in one session |
| *Independent* | Minimal dependencies on other features |
| *Testable* | Has clear pass/fail criteria |
| *Valuable* | Delivers incremental progress |

** Writing to Features Section

Create TODO items in the Features section:

#+begin_example
** Features :features:
:PROPERTIES:
:ORDERED: t
:END:

*** TODO Create auth middleware skeleton
Basic middleware structure at =src/middleware/auth.ts=

*** TODO Implement JWT validation
Token parsing and verification logic

*** TODO Add refresh token endpoint
POST /auth/refresh with token rotation

*** TODO Write auth middleware tests
Unit tests for validation edge cases

*** TODO Integration test auth flow
End-to-end test for login → refresh → logout
#+end_example

** Feature Format

Each TODO should include:
1. *Clear title*: Action verb + specific outcome
2. *Brief description*: 1-2 lines of context
3. *Acceptance criteria* (optional): What "done" means

** Ordering Strategy

Features are ORDERED (=:ORDERED: t= property):
1. *Foundation first*: Data models, interfaces
2. *Core logic next*: Main functionality
3. *Integration after*: Connecting components
4. *Tests last*: Verify everything works

** Size Guidelines

If a feature seems too large, decompose it:

| Too Large | Better Breakdown |
|-----------+------------------|
| "Implement auth" | Create middleware → Add validation → Add refresh |
| "Add tests" | Unit tests → Integration tests → E2E tests |
| "Build API" | Define routes → Add handlers → Add validation |

** TDD in Feature TODOs

Include test criteria in TODO items for clarity:

#+begin_example
*** TODO Implement JWT validation middleware
Test: Should reject requests without Authorization header
Test: Should reject expired tokens
Test: Should attach user to request on valid token
- Parse Bearer token from header
- Verify signature with secret
- Check expiration
- Return 401 on failure
#+end_example

** Progress Tracking

The Features section enables session continuity:
- Count DONE items = completed work
- Count TODO items = remaining work
- First TODO = current focus
- =:ORDERED: t= ensures sequential execution

When resuming work:
1. Read Features section
2. Note which items are DONE
3. Find first TODO
4. Continue from there

** Implementation Handoff

After planning:
1. Review TODO list with user
2. Confirm ordering makes sense
3. Identify any dependencies or blockers
4. Get approval to begin Implementation phase

The Features section becomes the *work queue* for implementation.
