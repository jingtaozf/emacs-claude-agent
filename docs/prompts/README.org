#+TITLE: Prompt Documentation
#+PROPERTY: header-args :results silent

* Overview
:PROPERTIES:
:CUSTOM_ID: README-overview
:END:

This folder contains all prompts used by claude-org-mode, organized by type.
Prompts are stored as org files for consistency with the project's literate
programming approach.

* Directory Structure
:PROPERTIES:
:CUSTOM_ID: README-directory-structure
:END:

| Folder    | Purpose                                      | Usage                           |
|-----------+----------------------------------------------+---------------------------------|
| =system/= | Base system prompts (always loaded)          | Numbered for load order         |
| =tags/=   | Tag behavior prompts (=:tag:= on headings)   | One file per tag                |
| =headers/=| Header argument prompts (=:key value=)       | One file per header, subdirs ok |

Skills are stored in =.claude/skills/= for native Claude Code integration.

* File Format Standard
:PROPERTIES:
:CUSTOM_ID: README-file-format-standard
:END:

Each prompt file uses consistent org structure:

#+begin_example
,#+TITLE: Research Phase
,#+DESCRIPTION: Exploration and discovery phase

,* RESEARCH MODE

Focus on understanding. Use Read/Grep/Glob/LSP tools. Do NOT modify files.
Summarize findings clearly. Ask clarifying questions if needed.
#+end_example

* SDD Workflow
:PROPERTIES:
:CUSTOM_ID: README-sdd-workflow
:END:

SDD (Spec-Driven Development) is a structured workflow for feature development
based on the [[https://alexlavaee.me/blog/atomic-workflow/][Atomic Workflow]] pattern:
Research → Design → Planning → Implementation.

** Key Concepts

| Concept | Description |
|---------+-------------|
| *Parallel Research* | Multiple agents explore codebase simultaneously |
| *Dual Memory* | Spec (lasting) + Features (active) survive context resets |
| *Atomic Features* | Each TODO small enough to complete in one session |
| *Human Checkpoints* | Approval required at Research→Design and Planning→Implementation |

** Structure

Use =M-x claude-org-insert-sdd= (or =C-c C-d=) to create an SDD structure:

#+begin_example
,* Feature Name
:PROPERTIES:
:CLAUDE_SESSION_ID: sdd-20241225-120000
:END:

,** Workflow :sdd:              <- All AI interaction here
   ,*** Research :research:     <- Parallel agent exploration
   ,*** Design :design:         <- Technical design (RFC)
   ,*** Planning :planning:     <- Task breakdown
   ,*** Implementation :implementation:  <- Atomic TDD coding

,** Research Output :research_output:  <- Synthesized findings
   ,*** Codebase Patterns      <- Patterns with file:line refs
   ,*** Relevant Files         <- Key files discovered
   ,*** External References    <- Docs, best practices

,** Spec :spec:                 <- Living RFC document
   ,*** Goals
   ,*** Non-Goals
   ,*** Proposed Solution
   ,*** Technical Design

,** Features :features:         <- Atomic TODO list
   ,*** TODO Task 1            <- First incomplete = current focus
   ,*** TODO Task 2
#+end_example

** Parallel Research Agents

In Research phase, dispatch these agents in parallel:

| Agent | Purpose | Output |
|-------+---------+--------|
| =codebase-locator= | Find WHERE files live | → Relevant Files |
| =codebase-analyzer= | Understand HOW code works | → Codebase Patterns |
| =codebase-pattern-finder= | Find existing patterns | → Codebase Patterns |
| =codebase-online-researcher= | External docs | → External References |

** SDD Tags

| Tag | Location | AI Blocks | Purpose |
|-----+----------+-----------+---------|
| =:sdd:= | Workflow section | Container | Workflow guidance, context |
| =:research:= | Workflow/* | *Yes* | Parallel exploration |
| =:design:= | Workflow/* | *Yes* | Technical design → Spec |
| =:planning:= | Workflow/* | *Yes* | Task breakdown → Features |
| =:implementation:= | Workflow/* | *Yes* | Atomic TDD, mark DONE |
| =:research_output:= | Top-level | No | Synthesized findings |
| =:spec:= | Top-level | No | Living RFC document |
| =:features:= | Top-level | No | Atomic TODO tracking |

** Workflow Phases

1. *Research*: Dispatch parallel agents, synthesize to Research Output
2. *Design*: Create RFC in Spec section (human approval checkpoint)
3. *Planning*: Break into atomic TODOs in Features section
4. *Implementation*: ONE feature at a time, mark DONE, stop

** Atomic Implementation

The Implementation phase enforces:
- Implement *ONE* TODO then STOP
- Use TDD (test first)
- Mark TODO as *DONE* using org-todo
- Report completion, wait for approval
- If context > 60%, stop and hand off

** Tag Inheritance

AI blocks inherit behavior from ancestor tags. In SDD structure:

#+begin_example
,* Feature
  ,** Workflow :sdd:             <- provides workflow context
     ,*** Research :research:    <- provides research behavior
         ,#+begin_src ai         <- inherits BOTH :sdd: AND :research:
#+end_example

* Available Tags
:PROPERTIES:
:CUSTOM_ID: README-available-tags
:END:

** SDD Workflow Tags

| Tag | Purpose |
|-----+---------|
| =sdd= | SDD workflow container (on Workflow section) |
| =research= | Parallel exploration phase |
| =design= | Technical design phase (RFC creation) |
| =planning= | Task breakdown phase (TODO creation) |
| =implementation= | Atomic TDD implementation phase |
| =research_output= | Synthesized parallel research findings |
| =spec= | Living RFC document (no AI blocks) |
| =features= | Atomic TODO list section (no AI blocks) |

** Legacy Workflow Phases

| Tag       | Purpose                                      |
|-----------+----------------------------------------------|
| =explore= | Research and understand (documentarian mode) |
| =plan=    | Design approach before implementing          |
| =code=    | Implement with TDD discipline                |
| =test=    | Write and run tests                          |
| =review=  | Find bugs and issues (no code changes)       |
| =commit=  | Stage and commit changes                     |

** Specialized Modes

| Tag        | Purpose                              |
|------------+--------------------------------------|
| =debug=    | Systematic debugging workflow        |
| =handoff=  | Create session continuation summary  |

** Modifiers (combine with phases)

| Tag        | Purpose                              |
|------------+--------------------------------------|
| =strict=   | Zero tolerance for issues            |
| =security= | Security-focused review              |
| =no_edit=  | Read-only mode                       |
| =parallel= | Use parallel subagents               |

* Available Header Arguments
:PROPERTIES:
:CUSTOM_ID: README-available-header-arguments
:END:

| Header      | Value        | Purpose                          |
|-------------+--------------+----------------------------------|
| =:phase=    | explore/plan/code/test/review/commit | Workflow phase     |
| =:tests=    | t            | Generate tests                   |
| =:coverage= | percentage   | Minimum test coverage            |
| =:strict=   | t            | Zero tolerance mode              |
| =:files=    | pattern      | Focus on specific files          |
| =:context=  | text         | Additional context               |
| =:agent=    | name         | Delegate to specialized agent    |

* Skills (in .claude/skills/)
:PROPERTIES:
:CUSTOM_ID: README-skills-in-claude-skills
:END:

Skills are domain knowledge loaded by Claude Code:

| Skill                   | Trigger                              |
|-------------------------+--------------------------------------|
| =testing-anti-patterns= | Writing or changing tests            |
| =prompt-engineer=       | Creating or optimizing prompts       |

* Usage Examples
:PROPERTIES:
:CUSTOM_ID: README-usage-examples
:END:

** SDD Workflow (Recommended)

#+begin_example
;; Create SDD structure
M-x claude-org-insert-sdd RET "JWT Authentication" RET

;; Work in Research phase
,* JWT Authentication
  ,** Workflow :sdd:
     ,*** Research :research:
         ,#+begin_src ai
         Explore authentication patterns in this codebase.
         ,#+end_src

;; Work in Implementation phase
     ,*** Implementation :implementation:
         ,#+begin_src ai
         Implement the first TODO from Features section.
         ,#+end_src
#+end_example

** Tag-based behavior (Legacy)

#+begin_example
,* My Task :explore:

,#+begin_src ai
How does the authentication system work?
,#+end_src
#+end_example

** Deep research with parallel agents

#+begin_example
,* Architecture Analysis :explore:parallel:

,#+begin_src ai
Document the complete data flow from API to database.
,#+end_src
#+end_example

** Implementation with TDD

#+begin_example
,* Feature :code:

,#+begin_src ai :tests t :coverage 80
Add a logout button to the header.
,#+end_src
#+end_example

** Session handoff

#+begin_example
,* End of Session :handoff:

,#+begin_src ai
Summarize current progress for next session.
,#+end_src
#+end_example

* Adding Custom Prompts
:PROPERTIES:
:CUSTOM_ID: README-adding-custom-prompts
:END:

1. Create a new =.org= file in the appropriate folder
2. Add =#+TITLE:= and =#+DESCRIPTION:= for documentation
3. Write the prompt content in org format
4. Update this README with the new tag/header

Prompts are loaded dynamically at runtime from =docs/prompts/tags/TAG.org=.
