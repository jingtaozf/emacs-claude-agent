#+TITLE: Features Section
#+PROPERTY: TAG features
#+PROPERTY: TYPE tag

* FEATURES SECTION
:PROPERTIES:
:CUSTOM_ID: tags-features-features-section
:END:

This section contains the *work queue* of atomic TODO items. It serves as
active memory that tracks implementation progress.

** Purpose

The Features section:
- Lists all work items as org TODOs
- Tracks completion state (TODO/DONE)
- Provides implementation order (ORDERED property)
- Enables session continuity

** Structure

Features use org-mode TODO states:

#+begin_example
** Features :features:
:PROPERTIES:
:ORDERED: t
:END:

*** DONE Create user model
*** DONE Add validation middleware
*** TODO Implement login endpoint    <- Current focus
*** TODO Add refresh token logic
*** TODO Write integration tests
#+end_example

** Finding Current Work

To find what to work on:
1. Scan for first *TODO* (not DONE)
2. That is the current feature to implement
3. Completed work is marked *DONE*

** Atomic Feature Guidelines

Each feature should be:

| Property | Description |
|----------+-------------|
| *Small* | Completable in one session (< 60% context) |
| *Focused* | Single responsibility |
| *Testable* | Clear pass/fail criteria |
| *Independent* | Minimal blocking dependencies |

** Test-Driven Development (TDD)

When implementing features, follow TDD principles:

*** TDD Cycle

1. *Red*: Write a failing test first
   - Define expected behavior before implementation
   - Test should fail because feature doesn't exist yet

2. *Green*: Write minimal code to pass
   - Only implement what's needed to pass the test
   - Don't over-engineer

3. *Refactor*: Clean up while tests pass
   - Improve code quality
   - Remove duplication
   - Tests must still pass after refactoring

*** TDD Feature Format

Include test criteria in TODO items:

#+begin_example
*** TODO Implement JWT validation middleware
Test: Should reject requests without Authorization header
Test: Should reject expired tokens
Test: Should attach user to request on valid token
- Parse Bearer token from header
- Verify signature with secret
- Check expiration
- Return 401 on failure
#+end_example

*** Writing Tests First

Before implementing any feature:
1. Create test file if it doesn't exist
2. Write test cases that define expected behavior
3. Run tests - they should fail (red)
4. Implement feature until tests pass (green)
5. Refactor while keeping tests green

*** Test Coverage

Ensure tests cover:
- *Happy path*: Normal successful operation
- *Edge cases*: Boundary conditions, empty inputs
- *Error handling*: Invalid inputs, failures
- *Integration*: Component interactions

** Marking Progress

Use org-todo to update states:
- =C-c C-t= cycles TODO â†’ DONE
- Or use MCP org tools to update

*IMPORTANT*: Only mark DONE when:
- Feature is fully implemented
- Tests are written and passing
- Code follows established patterns

** Feature Format

Good feature TODOs include:

#+begin_example
*** TODO Implement JWT validation middleware
Test: Should reject requests without Authorization header
Test: Should reject expired tokens
Test: Should attach user to request on valid token
- Parse Bearer token
- Verify signature with secret
- Check expiration
- Return 401 on failure
#+end_example

** Progress Tracking

The Features section shows overall progress:
- Count DONE items = completed work
- Count TODO items = remaining work
- First TODO = current focus
- ORDERED ensures sequential execution

** Session Resumption

When resuming work:
1. Read Features section
2. Note which items are DONE
3. Find first TODO
4. Continue from there

This enables seamless handoff between sessions.

** Feature Decomposition

If a TODO is too large:
1. Break it into smaller TODOs
2. Keep the original as a parent heading
3. Mark parent DONE when all children complete

#+begin_example
*** TODO Implement authentication [0/3]
**** TODO Create auth middleware
**** TODO Add token validation
**** TODO Write auth tests
#+end_example
