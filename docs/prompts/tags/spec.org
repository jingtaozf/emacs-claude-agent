#+TITLE: Spec Section
#+PROPERTY: TAG spec
#+PROPERTY: TYPE tag

* SPEC SECTION
:PROPERTIES:
:CUSTOM_ID: tags-spec-spec-section
:END:

This section contains the *living RFC document* for the feature. It serves as
persistent memory that survives context switches and session resets.

** Purpose

The Spec is the *source of truth* that:
- Documents all design decisions
- Captures trade-offs and rationale
- Provides context for future sessions
- Guides implementation work

** Structure

| Subsection | Purpose |
|------------+---------|
| *Goals* | What the feature WILL accomplish |
| *Non-Goals* | What is explicitly out of scope |
| *Proposed Solution* | High-level approach and architecture |
| *Technical Design* | Implementation details and interfaces |

** Updating the Spec

The Spec evolves during SDD:

| Phase | Spec Updates |
|-------+--------------|
| Research | Add findings that inform design |
| Design | Create initial Goals, Non-Goals, Solution |
| Planning | Refine Technical Design details |
| Implementation | Update with learnings, edge cases |

** Reading the Spec

When implementing or resuming work:
1. Read Goals to understand success criteria
2. Check Non-Goals to avoid scope creep
3. Follow Proposed Solution architecture
4. Implement per Technical Design details

** Spec Quality Checklist

Good specs have:
- [ ] Clear, measurable goals
- [ ] Explicit non-goals
- [ ] Trade-offs documented
- [ ] Implementation approach described
- [ ] Error handling considered
- [ ] Test strategy outlined

** Example Spec Content

#+begin_example
*** Goals

- Enable JWT-based authentication for API endpoints
- Support token refresh without full re-login
- Integrate with existing user model

*** Non-Goals

- Will NOT implement OAuth2 social login (future phase)
- Will NOT change password hashing algorithm
- Will NOT add session-based auth option

*** Proposed Solution

Use middleware-based JWT validation:
1. Auth middleware extracts and validates tokens
2. Refresh endpoint issues new token pairs
3. Protected routes use middleware

Trade-off: Chose stateless JWT over sessions for horizontal scaling.

*** Technical Design

*Token Structure*:
- Access token: 15 min expiry, contains user ID and roles
- Refresh token: 7 day expiry, stored in httpOnly cookie

*Endpoints*:
- POST /auth/login → { accessToken, refreshToken }
- POST /auth/refresh → { accessToken }
- POST /auth/logout → invalidate refresh token

*Middleware*:
- Extract token from Authorization header
- Verify signature and expiration
- Attach user to request context
#+end_example

** Spec as Contract

The approved Spec is a *contract*:
- Implementation must match the design
- Deviations require updating the Spec first
- Changes need human approval
