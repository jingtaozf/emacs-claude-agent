#+TITLE: Claude Agent SDK Integration Tests
#+SUBTITLE: Test fixture for integration testing
#+AUTHOR: Test Suite
#+PROPERTY: PROJECT_ROOT ~/projects/claude-agent
#+PROPERTY: CLAUDE_PERMISSION_MODE accept-edits

* Project Guidelines :system_prompt:
This is a test project for the Claude Agent SDK.
Always respond briefly for testing purposes.
Keep responses under 2 sentences when possible.

* Basic Query Tests

These tests verify basic query execution and response streaming.

** Instruction 1 :claude_chat:

#+begin_src ai
What is 2 + 2? Just answer with the number.
#+end_src

** Instruction 2 :claude_chat:

#+begin_src ai
What did I just ask you in Instruction 1?
#+end_src

* Session Scope Tests

These tests verify that sessions maintain context correctly.

** Session A - Numbers :claude_session:

This session tests numeric memory.

*** Instruction 3 :claude_chat:

#+begin_src ai
Remember this number: 42. Just confirm you remember it.
#+end_src

*** Instruction 4 :claude_chat:

#+begin_src ai
What number did I ask you to remember? Just the number.
#+end_src

** Session B - Colors :claude_session:

This session tests string memory (independent from Session A).

*** Instruction 5 :claude_chat:

#+begin_src ai
Remember this color: blue. Just confirm you remember it.
#+end_src

*** Instruction 6 :claude_chat:

#+begin_src ai
What color did I ask you to remember? Just the color.
#+end_src

* Tool Use Tests

These tests verify that Claude can use tools correctly.

** Instruction 7 :claude_chat:

#+begin_src ai
Use the Read tool to read the file README.md from the project root and tell me the first sentence.
#+end_src

** Instruction 8 :claude_chat:

#+begin_src ai
Use the Glob tool to find all .org files in the tests/fixtures directory.
#+end_src

* MCP Tool Access Tests

These tests verify that Emacs MCP tools are accessible.

** Instruction 16 :claude_chat:

#+begin_src ai
List all MCP tools you have access to. Just list the tool names, one per line.
#+end_src

* Multi-Session Concurrency Tests

These tests verify concurrent query execution.

** Concurrent Session 1 :claude_session:
:PROPERTIES:
:CLAUDE_SESSION_ID: concurrent-session-1
:END:

*** Instruction 9 :claude_chat:

#+begin_src ai
Count from 1 to 5 slowly: one... two... three... four... five. Just echo this back.
#+end_src

** Concurrent Session 2 :claude_session:
:PROPERTIES:
:CLAUDE_SESSION_ID: concurrent-session-2
:END:

*** Instruction 10 :claude_chat:

#+begin_src ai
List three fruits: apple, banana, orange. Just echo this back.
#+end_src

* Error Recovery Tests

These tests verify session recovery mechanisms.

** Instruction 11 :claude_chat:
:PROPERTIES:
:CLAUDE_SDK_UUID: intentionally-invalid-uuid-for-testing
:END:

#+begin_src ai
This should trigger session recovery because the SDK UUID is invalid.
Just respond with "Recovery successful" if you can read this.
#+end_src

* Permission Mode Tests

These tests verify different permission modes.

** Read-Only Test :claude_chat:
:PROPERTIES:
:CLAUDE_PERMISSION_MODE: readonly
:END:

*** Instruction 12 :claude_chat:

#+begin_src ai
Try to read the file README.md. You should ask for permission first.
#+end_src

** Plan Mode Test :claude_chat:
:PROPERTIES:
:CLAUDE_PERMISSION_MODE: plan
:END:

*** Instruction 13 :claude_chat:

#+begin_src ai
Suggest a plan to read all .el files in the tests directory.
#+end_src

* Block Insertion Tests

These instructions test the auto-numbering feature.

** Instruction 14 :claude_chat:

#+begin_src ai
This tests that instruction numbering works correctly.
#+end_src

* Environment Variable Tests
:PROPERTIES:
:ENV_FILE: ~/.env.test
:ANTHROPIC_MODEL: claude-sonnet-3-5
:END:

** Instruction 15 :claude_chat:

#+begin_src ai
What model are you using? (Should reflect ANTHROPIC_MODEL property)
#+end_src

* Link Resolution Tests

These tests verify that Claude can resolve org links in queries.

** Link Target Section

This section serves as a target for link resolution tests.

*** Important Config :link_target:

The special configuration value is: XYZZY-12345

This content should be retrieved when Claude resolves a link to this section.

** Instruction 17 :claude_chat:

This test verifies Claude can resolve an internal org link using evalElisp.

#+begin_src ai
Please read the content of [[*Important Config][Important Config]] section and tell me the special value.
#+end_src

** Instruction 18 :claude_chat:

This test verifies Claude can resolve a file link to an org heading.

#+begin_src ai
Resolve this link and summarize: [[file:test-session.org::*Project Guidelines][Project Guidelines]]
#+end_src

** Instruction 19 :claude_chat:

This test verifies Claude can resolve line number links using Read tool.

#+begin_src ai
Please use the Read tool to read [[file:test-session.org::5][line 5]] and tell me exactly what that line contains.
#+end_src

* Archived Section Test :ARCHIVE:

This section should be skipped during session recovery.

** Instruction 999 :claude_chat:

#+begin_src ai
This should never be included in session recovery context.
#+end_src

* Test Results Summary

This section will be updated by the test suite with results.

** Test Execution Log

- Test run: [timestamp will be inserted]
- Tests passed: [count]
- Tests failed: [count]
- Total duration: [time]

** Failed Tests

[Details of any failed tests will be inserted here]
